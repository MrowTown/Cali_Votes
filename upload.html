<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cali Votes — Upload</title>
  <link rel="stylesheet" href="style.css" />
  <script src="config.js"></script>
  <script src="app.js"></script>
</head>
<body>
  <div id="sessionBanner"></div>

  <div class="wrap">
    <div class="card">
      <h1>Upload your screenshot</h1>
      <p class="small">This link is tied to your submission. Upload a clear screenshot showing the payment.</p>
      <div class="instruction-card">
        <div class="instruction-title">This step</div>
        <div class="instruction-body">Choose the screenshot of your payment and upload it here. Next: we’ll review and approve your votes.</div>
      </div>

      <div id="msg" class="notice" style="display:none"></div>

      <label>Screenshot</label>
      <input id="file" type="file" accept="image/*" />

      <div class="row" style="margin-top:14px">
        <button id="up">Upload</button>
        <button class="secondary" id="home">Home</button>
      </div>

      <div class="footer">
        <a href="leaderboard.html">Leaderboard</a>
      </div>
    </div>
  </div>

<script>
  const token = qs("token");
  const msg = document.getElementById("msg");
  const show = (type, html)=>{ msg.className="notice "+type; msg.innerHTML=html; msg.style.display="block"; };

  if (!token) show("err", "<b>Missing token.</b> Use the upload link you were given.");

  document.getElementById("home").onclick = ()=> location.href="landing.html";

  document.getElementById("up").onclick = async ()=>{
    msg.style.display="none";
    const f = document.getElementById("file").files[0];
    if (!f) return show("err","Choose an image first.");
    const reader = new FileReader();
    reader.onload = async ()=>{
      const res = await post("uploadScreenshot", { token, screenshot: reader.result });
      if (res.error) return show("err","<b>Error:</b> "+esc(res.error));
      show("ok", "Uploaded! We’ll review and approve your votes soon.<br><a target='_blank' rel='noopener' href='"+esc(res.url)+"'>View uploaded file</a>");
    };
    reader.readAsDataURL(f);
  };
</script>
  <script>mountSessionBanner();</script>
</body>
</html>
